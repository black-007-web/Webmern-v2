{"ast":null,"code":"// Frontend/components/User.jsx\nimport React,{useEffect,useState}from'react';import axios from'axios';import\"../styles.css\";// Ensure your neon CSS is included\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const User=()=>{const[user,setUser]=useState(null);const[loading,setLoading]=useState(true);const BACKEND_URL='https://api-fable-forest.onrender.com';const fetchProfile=async()=>{try{const token=localStorage.getItem('token');if(!token){alert('No token found. Please login.');window.location.href='/login';return;}const res=await axios.get(`${BACKEND_URL}/api/user/profile`,{headers:{Authorization:`Bearer ${token}`}});setUser(res.data);setLoading(false);}catch(err){var _err$response;console.error('Error fetching user profile:',((_err$response=err.response)===null||_err$response===void 0?void 0:_err$response.data)||err.message);alert('Session expired or unauthorized. Please login again.');localStorage.removeItem('token');window.location.href='/login';}};const handleRemoveBook=async bookId=>{try{const token=localStorage.getItem('token');await axios.delete(`${BACKEND_URL}/api/user/books/${bookId}`,{headers:{Authorization:`Bearer ${token}`}});fetchProfile();}catch(err){var _err$response2;console.error('Error removing book:',((_err$response2=err.response)===null||_err$response2===void 0?void 0:_err$response2.data)||err.message);alert('Failed to remove book.');}};const handleReadBook=async bookId=>{try{const token=localStorage.getItem('token');const res=await axios.get(`${BACKEND_URL}/api/read/${bookId}`,{headers:{Authorization:`Bearer ${token}`}});if(res.data.pdfUrl){const fullPdfUrl=`${BACKEND_URL}${res.data.pdfUrl}`;window.open(fullPdfUrl,'_blank');}else{alert('PDF not available for this book.');}}catch(err){var _err$response3,_err$response4,_err$response4$data;console.error('Error reading book:',((_err$response3=err.response)===null||_err$response3===void 0?void 0:_err$response3.data)||err.message);alert(((_err$response4=err.response)===null||_err$response4===void 0?void 0:(_err$response4$data=_err$response4.data)===null||_err$response4$data===void 0?void 0:_err$response4$data.message)||'Cannot read this book.');}};useEffect(()=>{// Initialize movable particles only if element exists\nconst particlesElement=document.getElementById(\"particles-js\");if(particlesElement){window.particlesJS(\"particles-js\",{particles:{number:{value:70,density:{enable:true,value_area:800}},color:{value:\"#00ffff\"},shape:{type:\"circle\"},opacity:{value:0.6,anim:{enable:true,speed:1,opacity_min:0.3,sync:false}},size:{value:3,random:true,anim:{enable:true,speed:2,size_min:1,sync:false}},line_linked:{enable:true,distance:120,color:\"#00ffff\",opacity:0.3,width:1},move:{enable:true,speed:2,direction:\"none\",random:false,straight:false,out_mode:\"out\"}},interactivity:{detect_on:\"canvas\",events:{onhover:{enable:true,mode:\"repulse\"},onclick:{enable:true,mode:\"push\"}},modes:{repulse:{distance:100},push:{particles_nb:4}}},retina_detect:true});}fetchProfile();},[]);if(loading)return/*#__PURE__*/_jsx(\"div\",{className:\"user-loading\",children:\"Loading user info\\u2026\"});return/*#__PURE__*/_jsxs(\"div\",{className:\"user-dashboard\",children:[/*#__PURE__*/_jsx(\"div\",{id:\"particles-js\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"user-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"user-info neon-box\",children:[/*#__PURE__*/_jsxs(\"h2\",{children:[\"\\uD83D\\uDC64 Welcome, \",user.name]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Email: \",user.email]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"user-books neon-box\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"\\uD83D\\uDCDA Purchased Books\"}),user.purchasedBooks.length===0?/*#__PURE__*/_jsx(\"p\",{children:\"No books purchased yet.\"}):/*#__PURE__*/_jsx(\"ul\",{className:\"book-list\",children:user.purchasedBooks.map(book=>/*#__PURE__*/_jsxs(\"li\",{className:\"book-item neon-card\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"book-details\",children:[/*#__PURE__*/_jsx(\"h4\",{children:book.title}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Genre: \",book.genre]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Price: $\",book.price]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"book-actions\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleRemoveBook(book._id),className:\"delete-button neon-btn\",children:\"\\u274C Remove\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleReadBook(book._id),className:\"read-button neon-btn\",children:\"\\uD83D\\uDCD6 Read\"})]})]},book._id))})]})]})]});};export default User;","map":{"version":3,"names":["React","useEffect","useState","axios","jsx","_jsx","jsxs","_jsxs","User","user","setUser","loading","setLoading","BACKEND_URL","fetchProfile","token","localStorage","getItem","alert","window","location","href","res","get","headers","Authorization","data","err","_err$response","console","error","response","message","removeItem","handleRemoveBook","bookId","delete","_err$response2","handleReadBook","pdfUrl","fullPdfUrl","open","_err$response3","_err$response4","_err$response4$data","particlesElement","document","getElementById","particlesJS","particles","number","value","density","enable","value_area","color","shape","type","opacity","anim","speed","opacity_min","sync","size","random","size_min","line_linked","distance","width","move","direction","straight","out_mode","interactivity","detect_on","events","onhover","mode","onclick","modes","repulse","push","particles_nb","retina_detect","className","children","id","name","email","purchasedBooks","length","map","book","title","genre","price","onClick","_id"],"sources":["C:/Users/HAZARY/Downloads/mern-web/mern-library/client/src/pages/User.jsx"],"sourcesContent":["// Frontend/components/User.jsx\r\nimport React, { useEffect, useState } from 'react';\r\nimport axios from 'axios';\r\nimport \"../styles.css\"; // Ensure your neon CSS is included\r\n\r\nconst User = () => {\r\n  const [user, setUser] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  const BACKEND_URL = 'https://api-fable-forest.onrender.com';\r\n\r\n  const fetchProfile = async () => {\r\n    try {\r\n      const token = localStorage.getItem('token');\r\n      if (!token) {\r\n        alert('No token found. Please login.');\r\n        window.location.href = '/login';\r\n        return;\r\n      }\r\n\r\n  const res = await axios.get(`${BACKEND_URL}/api/user/profile`, {\r\n        headers: { Authorization: `Bearer ${token}` },\r\n      });\r\n\r\n      setUser(res.data);\r\n      setLoading(false);\r\n    } catch (err) {\r\n      console.error('Error fetching user profile:', err.response?.data || err.message);\r\n      alert('Session expired or unauthorized. Please login again.');\r\n      localStorage.removeItem('token');\r\n      window.location.href = '/login';\r\n    }\r\n  };\r\n\r\n  const handleRemoveBook = async (bookId) => {\r\n    try {\r\n      const token = localStorage.getItem('token');\r\n  await axios.delete(`${BACKEND_URL}/api/user/books/${bookId}`, {\r\n        headers: { Authorization: `Bearer ${token}` },\r\n      });\r\n      fetchProfile();\r\n    } catch (err) {\r\n      console.error('Error removing book:', err.response?.data || err.message);\r\n      alert('Failed to remove book.');\r\n    }\r\n  };\r\n\r\n  const handleReadBook = async (bookId) => {\r\n    try {\r\n      const token = localStorage.getItem('token');\r\n  const res = await axios.get(`${BACKEND_URL}/api/read/${bookId}`, {\r\n        headers: { Authorization: `Bearer ${token}` },\r\n      });\r\n\r\n      if (res.data.pdfUrl) {\r\n        const fullPdfUrl = `${BACKEND_URL}${res.data.pdfUrl}`;\r\n        window.open(fullPdfUrl, '_blank');\r\n      } else {\r\n        alert('PDF not available for this book.');\r\n      }\r\n    } catch (err) {\r\n      console.error('Error reading book:', err.response?.data || err.message);\r\n      alert(err.response?.data?.message || 'Cannot read this book.');\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    // Initialize movable particles only if element exists\r\n    const particlesElement = document.getElementById(\"particles-js\");\r\n    if (particlesElement) {\r\n      window.particlesJS(\"particles-js\", {\r\n        particles: {\r\n          number: { value: 70, density: { enable: true, value_area: 800 } },\r\n          color: { value: \"#00ffff\" },\r\n          shape: { type: \"circle\" },\r\n          opacity: { value: 0.6, anim: { enable: true, speed: 1, opacity_min: 0.3, sync: false } },\r\n          size: { value: 3, random: true, anim: { enable: true, speed: 2, size_min: 1, sync: false } },\r\n          line_linked: { enable: true, distance: 120, color: \"#00ffff\", opacity: 0.3, width: 1 },\r\n          move: { enable: true, speed: 2, direction: \"none\", random: false, straight: false, out_mode: \"out\" },\r\n        },\r\n        interactivity: {\r\n          detect_on: \"canvas\",\r\n          events: {\r\n            onhover: { enable: true, mode: \"repulse\" },\r\n            onclick: { enable: true, mode: \"push\" },\r\n          },\r\n          modes: {\r\n            repulse: { distance: 100 },\r\n            push: { particles_nb: 4 },\r\n          },\r\n        },\r\n        retina_detect: true,\r\n      });\r\n    }\r\n\r\n    fetchProfile();\r\n  }, []);\r\n\r\n  if (loading) return <div className=\"user-loading\">Loading user info‚Ä¶</div>;\r\n\r\n  return (\r\n    <div className=\"user-dashboard\">\r\n      <div id=\"particles-js\"></div>\r\n      <div className=\"user-container\">\r\n        <div className=\"user-info neon-box\">\r\n          <h2>üë§ Welcome, {user.name}</h2>\r\n          <p>Email: {user.email}</p>\r\n        </div>\r\n\r\n        <div className=\"user-books neon-box\">\r\n          <h3>üìö Purchased Books</h3>\r\n          {user.purchasedBooks.length === 0 ? (\r\n            <p>No books purchased yet.</p>\r\n          ) : (\r\n            <ul className=\"book-list\">\r\n              {user.purchasedBooks.map((book) => (\r\n                <li key={book._id} className=\"book-item neon-card\">\r\n                  <div className=\"book-details\">\r\n                    <h4>{book.title}</h4>\r\n                    <p>Genre: {book.genre}</p>\r\n                    <p>Price: ${book.price}</p>\r\n                  </div>\r\n                  <div className=\"book-actions\">\r\n                    <button\r\n                      onClick={() => handleRemoveBook(book._id)}\r\n                      className=\"delete-button neon-btn\"\r\n                    >\r\n                      ‚ùå Remove\r\n                    </button>\r\n                    <button\r\n                      onClick={() => handleReadBook(book._id)}\r\n                      className=\"read-button neon-btn\"\r\n                    >\r\n                      üìñ Read\r\n                    </button>\r\n                  </div>\r\n                </li>\r\n              ))}\r\n            </ul>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default User;\r\n"],"mappings":"AAAA;AACA,MAAO,CAAAA,KAAK,EAAIC,SAAS,CAAEC,QAAQ,KAAQ,OAAO,CAClD,MAAO,CAAAC,KAAK,KAAM,OAAO,CACzB,MAAO,eAAe,CAAE;AAAA,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAExB,KAAM,CAAAC,IAAI,CAAGA,CAAA,GAAM,CACjB,KAAM,CAACC,IAAI,CAAEC,OAAO,CAAC,CAAGR,QAAQ,CAAC,IAAI,CAAC,CACtC,KAAM,CAACS,OAAO,CAAEC,UAAU,CAAC,CAAGV,QAAQ,CAAC,IAAI,CAAC,CAE5C,KAAM,CAAAW,WAAW,CAAG,uCAAuC,CAE3D,KAAM,CAAAC,YAAY,CAAG,KAAAA,CAAA,GAAY,CAC/B,GAAI,CACF,KAAM,CAAAC,KAAK,CAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,CAC3C,GAAI,CAACF,KAAK,CAAE,CACVG,KAAK,CAAC,+BAA+B,CAAC,CACtCC,MAAM,CAACC,QAAQ,CAACC,IAAI,CAAG,QAAQ,CAC/B,OACF,CAEJ,KAAM,CAAAC,GAAG,CAAG,KAAM,CAAAnB,KAAK,CAACoB,GAAG,CAAC,GAAGV,WAAW,mBAAmB,CAAE,CACzDW,OAAO,CAAE,CAAEC,aAAa,CAAE,UAAUV,KAAK,EAAG,CAC9C,CAAC,CAAC,CAEFL,OAAO,CAACY,GAAG,CAACI,IAAI,CAAC,CACjBd,UAAU,CAAC,KAAK,CAAC,CACnB,CAAE,MAAOe,GAAG,CAAE,KAAAC,aAAA,CACZC,OAAO,CAACC,KAAK,CAAC,8BAA8B,CAAE,EAAAF,aAAA,CAAAD,GAAG,CAACI,QAAQ,UAAAH,aAAA,iBAAZA,aAAA,CAAcF,IAAI,GAAIC,GAAG,CAACK,OAAO,CAAC,CAChFd,KAAK,CAAC,sDAAsD,CAAC,CAC7DF,YAAY,CAACiB,UAAU,CAAC,OAAO,CAAC,CAChCd,MAAM,CAACC,QAAQ,CAACC,IAAI,CAAG,QAAQ,CACjC,CACF,CAAC,CAED,KAAM,CAAAa,gBAAgB,CAAG,KAAO,CAAAC,MAAM,EAAK,CACzC,GAAI,CACF,KAAM,CAAApB,KAAK,CAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,CAC/C,KAAM,CAAAd,KAAK,CAACiC,MAAM,CAAC,GAAGvB,WAAW,mBAAmBsB,MAAM,EAAE,CAAE,CACxDX,OAAO,CAAE,CAAEC,aAAa,CAAE,UAAUV,KAAK,EAAG,CAC9C,CAAC,CAAC,CACFD,YAAY,CAAC,CAAC,CAChB,CAAE,MAAOa,GAAG,CAAE,KAAAU,cAAA,CACZR,OAAO,CAACC,KAAK,CAAC,sBAAsB,CAAE,EAAAO,cAAA,CAAAV,GAAG,CAACI,QAAQ,UAAAM,cAAA,iBAAZA,cAAA,CAAcX,IAAI,GAAIC,GAAG,CAACK,OAAO,CAAC,CACxEd,KAAK,CAAC,wBAAwB,CAAC,CACjC,CACF,CAAC,CAED,KAAM,CAAAoB,cAAc,CAAG,KAAO,CAAAH,MAAM,EAAK,CACvC,GAAI,CACF,KAAM,CAAApB,KAAK,CAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,CAC/C,KAAM,CAAAK,GAAG,CAAG,KAAM,CAAAnB,KAAK,CAACoB,GAAG,CAAC,GAAGV,WAAW,aAAasB,MAAM,EAAE,CAAE,CAC3DX,OAAO,CAAE,CAAEC,aAAa,CAAE,UAAUV,KAAK,EAAG,CAC9C,CAAC,CAAC,CAEF,GAAIO,GAAG,CAACI,IAAI,CAACa,MAAM,CAAE,CACnB,KAAM,CAAAC,UAAU,CAAG,GAAG3B,WAAW,GAAGS,GAAG,CAACI,IAAI,CAACa,MAAM,EAAE,CACrDpB,MAAM,CAACsB,IAAI,CAACD,UAAU,CAAE,QAAQ,CAAC,CACnC,CAAC,IAAM,CACLtB,KAAK,CAAC,kCAAkC,CAAC,CAC3C,CACF,CAAE,MAAOS,GAAG,CAAE,KAAAe,cAAA,CAAAC,cAAA,CAAAC,mBAAA,CACZf,OAAO,CAACC,KAAK,CAAC,qBAAqB,CAAE,EAAAY,cAAA,CAAAf,GAAG,CAACI,QAAQ,UAAAW,cAAA,iBAAZA,cAAA,CAAchB,IAAI,GAAIC,GAAG,CAACK,OAAO,CAAC,CACvEd,KAAK,CAAC,EAAAyB,cAAA,CAAAhB,GAAG,CAACI,QAAQ,UAAAY,cAAA,kBAAAC,mBAAA,CAAZD,cAAA,CAAcjB,IAAI,UAAAkB,mBAAA,iBAAlBA,mBAAA,CAAoBZ,OAAO,GAAI,wBAAwB,CAAC,CAChE,CACF,CAAC,CAED/B,SAAS,CAAC,IAAM,CACd;AACA,KAAM,CAAA4C,gBAAgB,CAAGC,QAAQ,CAACC,cAAc,CAAC,cAAc,CAAC,CAChE,GAAIF,gBAAgB,CAAE,CACpB1B,MAAM,CAAC6B,WAAW,CAAC,cAAc,CAAE,CACjCC,SAAS,CAAE,CACTC,MAAM,CAAE,CAAEC,KAAK,CAAE,EAAE,CAAEC,OAAO,CAAE,CAAEC,MAAM,CAAE,IAAI,CAAEC,UAAU,CAAE,GAAI,CAAE,CAAC,CACjEC,KAAK,CAAE,CAAEJ,KAAK,CAAE,SAAU,CAAC,CAC3BK,KAAK,CAAE,CAAEC,IAAI,CAAE,QAAS,CAAC,CACzBC,OAAO,CAAE,CAAEP,KAAK,CAAE,GAAG,CAAEQ,IAAI,CAAE,CAAEN,MAAM,CAAE,IAAI,CAAEO,KAAK,CAAE,CAAC,CAAEC,WAAW,CAAE,GAAG,CAAEC,IAAI,CAAE,KAAM,CAAE,CAAC,CACxFC,IAAI,CAAE,CAAEZ,KAAK,CAAE,CAAC,CAAEa,MAAM,CAAE,IAAI,CAAEL,IAAI,CAAE,CAAEN,MAAM,CAAE,IAAI,CAAEO,KAAK,CAAE,CAAC,CAAEK,QAAQ,CAAE,CAAC,CAAEH,IAAI,CAAE,KAAM,CAAE,CAAC,CAC5FI,WAAW,CAAE,CAAEb,MAAM,CAAE,IAAI,CAAEc,QAAQ,CAAE,GAAG,CAAEZ,KAAK,CAAE,SAAS,CAAEG,OAAO,CAAE,GAAG,CAAEU,KAAK,CAAE,CAAE,CAAC,CACtFC,IAAI,CAAE,CAAEhB,MAAM,CAAE,IAAI,CAAEO,KAAK,CAAE,CAAC,CAAEU,SAAS,CAAE,MAAM,CAAEN,MAAM,CAAE,KAAK,CAAEO,QAAQ,CAAE,KAAK,CAAEC,QAAQ,CAAE,KAAM,CACrG,CAAC,CACDC,aAAa,CAAE,CACbC,SAAS,CAAE,QAAQ,CACnBC,MAAM,CAAE,CACNC,OAAO,CAAE,CAAEvB,MAAM,CAAE,IAAI,CAAEwB,IAAI,CAAE,SAAU,CAAC,CAC1CC,OAAO,CAAE,CAAEzB,MAAM,CAAE,IAAI,CAAEwB,IAAI,CAAE,MAAO,CACxC,CAAC,CACDE,KAAK,CAAE,CACLC,OAAO,CAAE,CAAEb,QAAQ,CAAE,GAAI,CAAC,CAC1Bc,IAAI,CAAE,CAAEC,YAAY,CAAE,CAAE,CAC1B,CACF,CAAC,CACDC,aAAa,CAAE,IACjB,CAAC,CAAC,CACJ,CAEArE,YAAY,CAAC,CAAC,CAChB,CAAC,CAAE,EAAE,CAAC,CAEN,GAAIH,OAAO,CAAE,mBAAON,IAAA,QAAK+E,SAAS,CAAC,cAAc,CAAAC,QAAA,CAAC,yBAAkB,CAAK,CAAC,CAE1E,mBACE9E,KAAA,QAAK6E,SAAS,CAAC,gBAAgB,CAAAC,QAAA,eAC7BhF,IAAA,QAAKiF,EAAE,CAAC,cAAc,CAAM,CAAC,cAC7B/E,KAAA,QAAK6E,SAAS,CAAC,gBAAgB,CAAAC,QAAA,eAC7B9E,KAAA,QAAK6E,SAAS,CAAC,oBAAoB,CAAAC,QAAA,eACjC9E,KAAA,OAAA8E,QAAA,EAAI,wBAAY,CAAC5E,IAAI,CAAC8E,IAAI,EAAK,CAAC,cAChChF,KAAA,MAAA8E,QAAA,EAAG,SAAO,CAAC5E,IAAI,CAAC+E,KAAK,EAAI,CAAC,EACvB,CAAC,cAENjF,KAAA,QAAK6E,SAAS,CAAC,qBAAqB,CAAAC,QAAA,eAClChF,IAAA,OAAAgF,QAAA,CAAI,8BAAkB,CAAI,CAAC,CAC1B5E,IAAI,CAACgF,cAAc,CAACC,MAAM,GAAK,CAAC,cAC/BrF,IAAA,MAAAgF,QAAA,CAAG,yBAAuB,CAAG,CAAC,cAE9BhF,IAAA,OAAI+E,SAAS,CAAC,WAAW,CAAAC,QAAA,CACtB5E,IAAI,CAACgF,cAAc,CAACE,GAAG,CAAEC,IAAI,eAC5BrF,KAAA,OAAmB6E,SAAS,CAAC,qBAAqB,CAAAC,QAAA,eAChD9E,KAAA,QAAK6E,SAAS,CAAC,cAAc,CAAAC,QAAA,eAC3BhF,IAAA,OAAAgF,QAAA,CAAKO,IAAI,CAACC,KAAK,CAAK,CAAC,cACrBtF,KAAA,MAAA8E,QAAA,EAAG,SAAO,CAACO,IAAI,CAACE,KAAK,EAAI,CAAC,cAC1BvF,KAAA,MAAA8E,QAAA,EAAG,UAAQ,CAACO,IAAI,CAACG,KAAK,EAAI,CAAC,EACxB,CAAC,cACNxF,KAAA,QAAK6E,SAAS,CAAC,cAAc,CAAAC,QAAA,eAC3BhF,IAAA,WACE2F,OAAO,CAAEA,CAAA,GAAM9D,gBAAgB,CAAC0D,IAAI,CAACK,GAAG,CAAE,CAC1Cb,SAAS,CAAC,wBAAwB,CAAAC,QAAA,CACnC,eAED,CAAQ,CAAC,cACThF,IAAA,WACE2F,OAAO,CAAEA,CAAA,GAAM1D,cAAc,CAACsD,IAAI,CAACK,GAAG,CAAE,CACxCb,SAAS,CAAC,sBAAsB,CAAAC,QAAA,CACjC,mBAED,CAAQ,CAAC,EACN,CAAC,GAnBCO,IAAI,CAACK,GAoBV,CACL,CAAC,CACA,CACL,EACE,CAAC,EACH,CAAC,EACH,CAAC,CAEV,CAAC,CAED,cAAe,CAAAzF,IAAI","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}