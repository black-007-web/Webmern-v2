{"ast":null,"code":"// Frontend/components/User.jsx\nimport React,{useEffect,useState}from'react';import axios from'axios';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const User=()=>{const[user,setUser]=useState(null);const[loading,setLoading]=useState(true);// Replace with your backend URL if frontend runs on a different port\nconst BACKEND_URL='http://localhost:5000';const fetchProfile=async()=>{try{const token=localStorage.getItem('token');if(!token){alert('No token found. Please login.');window.location.href='/login';return;}const res=await axios.get(`${BACKEND_URL}/api/user/profile`,{headers:{Authorization:`Bearer ${token}`}});setUser(res.data);setLoading(false);}catch(err){var _err$response;console.error('Error fetching user profile:',((_err$response=err.response)===null||_err$response===void 0?void 0:_err$response.data)||err.message);alert('Session expired or unauthorized. Please login again.');localStorage.removeItem('token');window.location.href='/login';}};const handleRemoveBook=async bookId=>{try{const token=localStorage.getItem('token');await axios.delete(`${BACKEND_URL}/api/user/books/${bookId}`,{headers:{Authorization:`Bearer ${token}`}});fetchProfile();}catch(err){var _err$response2;console.error('Error removing book:',((_err$response2=err.response)===null||_err$response2===void 0?void 0:_err$response2.data)||err.message);alert('Failed to remove book.');}};const handleReadBook=async bookId=>{try{const token=localStorage.getItem('token');const res=await axios.get(`${BACKEND_URL}/api/read/${bookId}`,{headers:{Authorization:`Bearer ${token}`}});if(res.data.pdfUrl){// Prepend backend URL to relative PDF path\nconst fullPdfUrl=`${BACKEND_URL}${res.data.pdfUrl}`;// Open PDF in new tab\nwindow.open(fullPdfUrl,'_blank');}else{alert('PDF not available for this book.');}}catch(err){var _err$response3,_err$response4,_err$response4$data;console.error('Error reading book:',((_err$response3=err.response)===null||_err$response3===void 0?void 0:_err$response3.data)||err.message);alert(((_err$response4=err.response)===null||_err$response4===void 0?void 0:(_err$response4$data=_err$response4.data)===null||_err$response4$data===void 0?void 0:_err$response4$data.message)||'Cannot read this book.');}};useEffect(()=>{fetchProfile();},[]);if(loading)return/*#__PURE__*/_jsx(\"div\",{className:\"user-loading\",children:\"Loading user info\\u2026\"});return/*#__PURE__*/_jsxs(\"div\",{className:\"user-dashboard\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"user-info\",children:[/*#__PURE__*/_jsxs(\"h2\",{children:[\"\\uD83D\\uDC64 Welcome, \",user.name]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Email: \",user.email]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"user-books\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"\\uD83D\\uDCDA Purchased Books\"}),user.purchasedBooks.length===0?/*#__PURE__*/_jsx(\"p\",{children:\"No books purchased yet.\"}):/*#__PURE__*/_jsx(\"ul\",{className:\"book-list\",children:user.purchasedBooks.map(book=>/*#__PURE__*/_jsxs(\"li\",{className:\"book-item\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"book-details\",children:[/*#__PURE__*/_jsx(\"h4\",{children:book.title}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Genre: \",book.genre]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Price: $\",book.price]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleRemoveBook(book._id),className:\"delete-button\",children:\"\\u274C Remove\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleReadBook(book._id),className:\"read-button\",children:\"\\uD83D\\uDCD6 Read\"})]})]},book._id))})]})]});};export default User;","map":{"version":3,"names":["React","useEffect","useState","axios","jsx","_jsx","jsxs","_jsxs","User","user","setUser","loading","setLoading","BACKEND_URL","fetchProfile","token","localStorage","getItem","alert","window","location","href","res","get","headers","Authorization","data","err","_err$response","console","error","response","message","removeItem","handleRemoveBook","bookId","delete","_err$response2","handleReadBook","pdfUrl","fullPdfUrl","open","_err$response3","_err$response4","_err$response4$data","className","children","name","email","purchasedBooks","length","map","book","title","genre","price","onClick","_id"],"sources":["C:/Users/HAZARY/Downloads/mern-web/mern-library/client/src/pages/User.jsx"],"sourcesContent":["// Frontend/components/User.jsx\r\nimport React, { useEffect, useState } from 'react';\r\nimport axios from 'axios';\r\n\r\nconst User = () => {\r\n  const [user, setUser] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  // Replace with your backend URL if frontend runs on a different port\r\n  const BACKEND_URL = 'http://localhost:5000';\r\n\r\n  const fetchProfile = async () => {\r\n    try {\r\n      const token = localStorage.getItem('token');\r\n      if (!token) {\r\n        alert('No token found. Please login.');\r\n        window.location.href = '/login';\r\n        return;\r\n      }\r\n\r\n      const res = await axios.get(`${BACKEND_URL}/api/user/profile`, {\r\n        headers: { Authorization: `Bearer ${token}` },\r\n      });\r\n\r\n      setUser(res.data);\r\n      setLoading(false);\r\n    } catch (err) {\r\n      console.error('Error fetching user profile:', err.response?.data || err.message);\r\n      alert('Session expired or unauthorized. Please login again.');\r\n      localStorage.removeItem('token');\r\n      window.location.href = '/login';\r\n    }\r\n  };\r\n\r\n  const handleRemoveBook = async (bookId) => {\r\n    try {\r\n      const token = localStorage.getItem('token');\r\n      await axios.delete(`${BACKEND_URL}/api/user/books/${bookId}`, {\r\n        headers: { Authorization: `Bearer ${token}` },\r\n      });\r\n      fetchProfile();\r\n    } catch (err) {\r\n      console.error('Error removing book:', err.response?.data || err.message);\r\n      alert('Failed to remove book.');\r\n    }\r\n  };\r\n\r\n  const handleReadBook = async (bookId) => {\r\n    try {\r\n      const token = localStorage.getItem('token');\r\n      const res = await axios.get(`${BACKEND_URL}/api/read/${bookId}`, {\r\n        headers: { Authorization: `Bearer ${token}` },\r\n      });\r\n\r\n      if (res.data.pdfUrl) {\r\n        // Prepend backend URL to relative PDF path\r\n        const fullPdfUrl = `${BACKEND_URL}${res.data.pdfUrl}`;\r\n        // Open PDF in new tab\r\n        window.open(fullPdfUrl, '_blank');\r\n      } else {\r\n        alert('PDF not available for this book.');\r\n      }\r\n    } catch (err) {\r\n      console.error('Error reading book:', err.response?.data || err.message);\r\n      alert(err.response?.data?.message || 'Cannot read this book.');\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchProfile();\r\n  }, []);\r\n\r\n  if (loading) return <div className=\"user-loading\">Loading user info‚Ä¶</div>;\r\n\r\n  return (\r\n    <div className=\"user-dashboard\">\r\n      <div className=\"user-info\">\r\n        <h2>üë§ Welcome, {user.name}</h2>\r\n        <p>Email: {user.email}</p>\r\n      </div>\r\n\r\n      <div className=\"user-books\">\r\n        <h3>üìö Purchased Books</h3>\r\n        {user.purchasedBooks.length === 0 ? (\r\n          <p>No books purchased yet.</p>\r\n        ) : (\r\n          <ul className=\"book-list\">\r\n            {user.purchasedBooks.map((book) => (\r\n              <li key={book._id} className=\"book-item\">\r\n                <div className=\"book-details\">\r\n                  <h4>{book.title}</h4>\r\n                  <p>Genre: {book.genre}</p>\r\n                  <p>Price: ${book.price}</p>\r\n                </div>\r\n                <div>\r\n                  <button\r\n                    onClick={() => handleRemoveBook(book._id)}\r\n                    className=\"delete-button\"\r\n                  >\r\n                    ‚ùå Remove\r\n                  </button>\r\n                  <button\r\n                    onClick={() => handleReadBook(book._id)}\r\n                    className=\"read-button\"\r\n                  >\r\n                    üìñ Read\r\n                  </button>\r\n                </div>\r\n              </li>\r\n            ))}\r\n          </ul>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default User;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}